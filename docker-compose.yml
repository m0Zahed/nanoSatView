services:
  auth-service:
    build:
      context: ./nanoSatAPI/UserManagement
      dockerfile: Dockerfile
    ports:
      - "5000:5000"
    environment:
      PORT: 5000
      APP_VERSION: dev
      CLIENT_ORIGIN: http://localhost:5173
      VERIFY_PAGE_URL: http://localhost:5173/verify-email
      RESET_PAGE_URL: http://localhost:5173/reset-password
      GOOGLE_CLIENT_ID: ${GOOGLE_CLIENT_ID:-}
      GOOGLE_CLIENT_SECRET: ${GOOGLE_CLIENT_SECRET:-}
      GOOGLE_REDIRECT_URI: http://localhost:5000/auth/google/callback
      SMTP_HOST: mailhog
      SMTP_PORT: 1025
      SMTP_USER: ${SMTP_USER:-}
      SMTP_PASS: ${SMTP_PASS:-}
      EMAIL_FROM: ${EMAIL_FROM:-no-reply@local.test}
    depends_on:
      - mailhog

  requirements-api:
    build:
      context: ./nanoSatAPI/RequirementManagement
      dockerfile: Dockerfile
    ports:
      - "5001:5001"
    environment:
      ConnectionStrings__Default: Host=postgres;Port=5432;Database=requirements;Username=postgres;Password=postgres
      ALLOWED_ORIGINS: http://localhost:5173
      FRONTEND__BASE_URL: http://localhost:5173
      APP_VERSION: dev
    depends_on:
      - postgres

  client-web:
    build:
      context: ./nanoSatSystems
      dockerfile: Dockerfile
    ports:
      - "5173:5173"
    environment:
      VITE_AUTH_BASE_URL: http://localhost:5000
      VITE_REQUIREMENTS_BASE_URL: http://localhost:5001

  typesense:
    image: typesense/typesense:26.0
    restart: "no"
    ports:
      - "8200:8108"
    volumes:
      - ./typesense_server:/data
    command: "--data-dir /data --api-key=xyz --enable-cors"

  postgres:
    image: postgres:16-alpine
    ports:
      - "5432:5432"
    environment:
      POSTGRES_DB: requirements
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    volumes:
      - postgres-data:/var/lib/postgresql/data

  mailhog:
    image: mailhog/mailhog:v1.0.1
    ports:
      - "1025:1025"
      - "8025:8025"

volumes:
  postgres-data:
